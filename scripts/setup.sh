#!/bin/bash

# Jira OpenAI Automation Service - Setup Script

echo "๐ ะะฐัััะพะนะบะฐ Jira OpenAI Automation Service..."

# ะัะพะฒะตััะตะผ ะฝะฐะปะธัะธะต Node.js
if ! command -v node &> /dev/null; then
    echo "โ Node.js ะฝะต ะฝะฐะนะดะตะฝ. ะะพะถะฐะปัะนััะฐ, ัััะฐะฝะพะฒะธัะต Node.js 16+ ั https://nodejs.org/"
    exit 1
fi

# ะัะพะฒะตััะตะผ ะฒะตััะธั Node.js
NODE_VERSION=$(node -v | cut -d'v' -f2 | cut -d'.' -f1)
if [ "$NODE_VERSION" -lt 16 ]; then
    echo "โ ะขัะตะฑัะตััั Node.js ะฒะตััะธะธ 16 ะธะปะธ ะฒััะต. ะขะตะบััะฐั ะฒะตััะธั: $(node -v)"
    exit 1
fi

echo "โ Node.js ะฒะตััะธั: $(node -v)"

# ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ
echo "๐ฆ ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน..."
npm install

if [ $? -ne 0 ]; then
    echo "โ ะัะธะฑะบะฐ ะฟัะธ ัััะฐะฝะพะฒะบะต ะทะฐะฒะธัะธะผะพััะตะน"
    exit 1
fi

echo "โ ะะฐะฒะธัะธะผะพััะธ ัััะฐะฝะพะฒะปะตะฝั"

# ะกะพะทะดะฐะตะผ .env ัะฐะนะป ะตัะปะธ ะตะณะพ ะฝะตั
if [ ! -f .env ]; then
    echo "๐ ะกะพะทะดะฐะฝะธะต ัะฐะนะปะฐ .env..."
    cp env.example .env
    echo "โ ะคะฐะนะป .env ัะพะทะดะฐะฝ. ะะพะถะฐะปัะนััะฐ, ะพััะตะดะฐะบัะธััะนัะต ะตะณะพ ั ะฒะฐัะธะผะธ ะฝะฐัััะพะนะบะฐะผะธ."
else
    echo "โ ะคะฐะนะป .env ัะถะต ัััะตััะฒัะตั"
fi

# ะกะพะทะดะฐะตะผ ะดะธัะตะบัะพัะธั ะดะปั ะปะพะณะพะฒ
mkdir -p logs
echo "โ ะะธัะตะบัะพัะธั ะดะปั ะปะพะณะพะฒ ัะพะทะดะฐะฝะฐ"

# ะัะพะฒะตััะตะผ ะฟัะฐะฒะฐ ะฝะฐ ะฒัะฟะพะปะฝะตะฝะธะต
chmod +x scripts/*.sh 2>/dev/null || true

echo ""
echo "๐ ะะฐัััะพะนะบะฐ ะทะฐะฒะตััะตะฝะฐ!"
echo ""
echo "๐ ะกะปะตะดัััะธะต ัะฐะณะธ:"
echo "1. ะััะตะดะฐะบัะธััะนัะต ัะฐะนะป .env ั ะฒะฐัะธะผะธ ะฝะฐัััะพะนะบะฐะผะธ"
echo "2. ะะฐะฟัััะธัะต ัะตัะฒะธั: npm run dev"
echo "3. ะัะพะฒะตัััะต ะทะดะพัะพะฒัะต: curl http://localhost:3000/api/health"
echo ""
echo "๐ ะะพะบัะผะตะฝัะฐัะธั: README.md"
echo "๐งช ะขะตััะพะฒัะต ะทะฐะฟัะพัั: examples/test-requests.http"
